<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"  %>
<%@ taglib uri="http://displaytag.sf.net" prefix="display"%>
<%@ taglib uri='http://www.springframework.org/security/tags' prefix='security'%>

<jsp:include page="../includes/head.jsp"/>
    <script type="text/javascript">
    	function nuevo(){
    			document.forms[0].action="prenuevo.htm";
    			document.forms[0].submit();
    	}
    	function buscar(){
			document.forms[0].action="buscar.htm";
			document.forms[0].submit();
		}
    	function eliminar(id){
    		if(confirm('seguro que desea eliminar la alerta?')){
    			document.forms[0].action="eliminar.htm?cod="+id;
    			document.forms[0].submit();	
    		}
		}
    	
    	$(function() {
    		$( "#tags" ).autocomplete({
    			width: 300,
    	        max: 10,
    	        delay: 100,
    	        autoFocus: true,
    	        cacheLength: 1,
    	        scroll: true,
    	        highlight: false,
    			source: function(request, response) {
    	            $.ajax({
    	                url: "${pageContext.request.contextPath}/admin/lpersonasAuto.htm",
    	                dataType: "json",
    	                data: request,
    	                success: function( data, textStatus, jqXHR) {
    	                    /*console.log( data);*/
    	                    var items = data;
    	                    response(items);
    	                },
    	                error: function(jqXHR, textStatus, errorThrown){
    	                     console.log(textStatus);
    	                }
    	            });
    	        },
    			minLength: 2,
    			select: function( event, ui ) {
    				  $( "#idPersona" ).val( ui.item.id );
    			}
    		});
    	});
    	
    	 $( function(){
    	   $("#displayTagDiv").displayTagAjax();
    	})
	    	
	    	
    </script>
       <form:form name="frmlista" action="buscar.htm" method="post" modelAttribute="documento">
       
	<div id="contenedor"><!--Capa que contiene toda la plantilla-->
		<jsp:include page="../includes/cabecera.jsp" flush="true"/>
    <div id="cuerpo">
        <table class="anchoTotal">
        <tr>
        <td id="anchoMenu">
			<jsp:include page="../includes/menu2.jsp" flush="true"/>
		</td>
        <td id="anchoCuerpo">
          
          
          <input type="hidden" name="tipoTram1.idTipotram" value="1" />
          
            <div id="contenido"><!--Capa que contiene el cuerpo de la plantilla-->
            
            	<div align="center" style="color: red"> <c:out value="${msgError}"/> </div>
				<div align="center" style="color: blue"> <c:out value="${mensaje}"/> </div>
            
            	<h2>Lista de Oficios Cursados por notarios y poderes publicos(Inciso H - Art. 130 D.L 1049)</h2>
                <h4>Busqueda</h4>                
                
                <div class="capaEnlace">
                    <center>
                        <table summary="Contenedor Botones" class="tablaAnchoAjustable"><tr><td>
                            <ul class="enlacesCentroAjustables">
                                <li>
                                    <table class="bloqueTablaLineal" summary="Datos del Calendario">
                                         <tr>
                                            <th>Entidad:</th>
                                            <td colspan="3">
                                            	<form:select path="entidad.idEntidad" cssStyle="height: 20px; width: 180px; font-family: Arial; font-size: 9pt">
                                            		<form:option value="-1">-TODOS-</form:option>
	                                            	<form:options items="${lentidad}" itemLabel="nomEntidad" itemValue="idEntidad"/>
                                            	</form:select>
                                            </td>
                                        </tr>
                                      <tr>
                                        <th>Persona:</th>
                                        <td colspan="3">
                                        		<form:hidden path="persona.idPersona" id="idPersona"/>
                                            	<div class="demo">
													<div class="ui-widget">
														<input id="tags" type="text" size="40"/>
													</div>
												</div>
                                        </td>        
                                      </tr>
                                         <tr>
                                        <th>Alertas Registradas Desde:</th>
                                        <td>
                                        	<form:input path="fecRegistro" id="fecRegistro" size="15"/>
		                             		<img src="${pageContext.request.contextPath}/images/cal.gif" alt="D&iacute;a/Mes/A&ntilde;o" width="16" height="16" border="0" id="triggerCald" />
											<script type="text/javascript">
												var fechita = new Date();
												fechota = fechita.getDate() + "/" + (fechita.getMonth()+1) + "/" +  fechita.getFullYear();
											//	document.forms[0].fecRegistro.value = fechota;
													Calendar.setup({
														inputField     :    "fecRegistro",  // id del campo de texto
														ifFormat       :    "%d/%m/%Y",  // Formato de la Fecha
														showsTime      :    false,       // Flag para mostrar la Fecha
														button         :    "triggerCald",// ID del elemento que llamara al calendario
														singleClick    :    true         // Flag Modo doble-click 
													});
											</script></td>  
                                        <th>Hasta:</th>
                                        <td>
                                         	<form:input path="fecRegistro2" id="fecRegistro2" size="15"/>
		                             		<img src="${pageContext.request.contextPath}/images/cal.gif" alt="D&iacute;a/Mes/A&ntilde;o" width="16" height="16" border="0" id="triggerCalh" />
											<script type="text/javascript">
												var fechita = new Date();
												fechota = fechita.getDate()  + "/" + (fechita.getMonth()+1) + "/" +  fechita.getFullYear();
												//document.forms[0].fecRegistro2.value = fechota;
													Calendar.setup({
														inputField     :    "fecRegistro2",  // id del campo de texto
														ifFormat       :    "%d/%m/%Y",  // Formato de la Fecha
														showsTime      :    false,       // Flag para mostrar la Fecha
														button         :    "triggerCalh",// ID del elemento que llamara al calendario
														singleClick    :    true         // Flag Modo doble-click 
													});
											</script>
										</td>          
                                      </tr>
                                    </table>
                                </li>
                            </ul>
                        </td></tr></table>
                    </center>
                </div>
                
                <div class="capaEnlace">
                    <center>
                        <table summary="Contenedor Botones" class="tablaAnchoAjustable"><tr><td>
                            <ul class="enlacesCentroAjustables">
                              <li>
                               <input type="button" onclick="javascript:buscar();" class="boton" value="Buscar">
                               <security:authorize ifAnyGranted="ROLE_ADMIN">
                               <input type="button" onclick="javascript:nuevo();" class="boton" value="Nuevo">
                              </security:authorize>
                            </ul>
                        </td></tr>
                        </table>
                    </center>
                </div>
                <h4>LISTADO DE OFICIOS</h4>
                
               <div class="bloqueListadoDatos">
               
                      <div id="displayTagDiv">
                             <display:table name="requestScope.ldocumentos" requestURI="buscar.htm" class="displaytag" pagesize="25" defaultsort="1"
								defaultorder="ascending" export="false" id="row" excludedParams="ajax">
									<display:column title="F. Ingreso" sortable="true" headerClass="sortable">
										<fmt:formatDate value="${row.fecRegistro}" pattern="dd/MM/yyyy"/>
									</display:column>
									<display:column title="Quien Comunica" sortable="true" headerClass="sortable">
										<c:if test="${not empty row.documentoPersonas}">
			                            	<c:forEach items="${row.documentoPersonas}" var="per">
			                            		<c:if test="${per.tipoRelacion.idTipoRelacion == 3}">
			                            	   		${per.persona.nombreCompleto}<br>
			                            	   </c:if>
			                               </c:forEach>
			                           </c:if>
									</display:column>
									<display:column title="Asunto" property="docAsunto" sortable="true" headerClass="sortable" />
									<display:column title="Respuesta" property="docRespuesta" sortable="true" headerClass="sortable" />
						            <display:column title="F. Respuesta" sortable="true" headerClass="sortable">
						            	<fmt:formatDate value="${row.fecDocrespuesta}" pattern="dd/MM/yyyy"/>
						            </display:column>
						            <display:column title="Acciones" sortable="true" headerClass="sortable" style=" width: 80px;">
						            	<a href="ver.htm?cod=${row.idDocumento}" style="border: 0px;" title="Ver"><img src="${pageContext.request.contextPath}/images/view.jpg" width="18" height="18" border="0"></a>
                                    	<security:authorize ifAnyGranted="ROLE_ADMIN">
                                    	<a href="editar.htm?cod=${row.idDocumento}" style="border: 0px;" title="Modificar"><img src="${pageContext.request.contextPath}/images/edit.png" width="18" height="18" border="0"></a>                                    	
                                    	<a href="javascript:eliminar(${row.idDocumento});" style="border: 0px;" title="Eliminar"><img src="${pageContext.request.contextPath}/images/error.png" width="18" height="18" border="0"></a>
                                    	</security:authorize>
						            </display:column>
							 </display:table>
		 				</div>
		 			</div>
		 			
         	   </div>
         
         
        </td></tr></table>
        
        
		 				
    </div>
   
</div>

  
                     
</form:form>
 <jsp:include page="../includes/pie.jsp" flush="true"/>
