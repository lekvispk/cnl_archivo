<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"  %>

	<jsp:include page="../includes/head.jsp"/> 
        <script>

   	function cargar(){
   	    document.forms[1].action = "cargaralerta.htm";
   	    document.forms[1].submit();
   	}
   	function eliminar(cod,docum){
   	    if(confirm('Está segur de eliminar el Oficio')){
   	    	window.location='eliminarDoc.htm?id='+cod+"&cod="+docum;
   	    }
   	}
	function nuevo(){
      /*
        if (document.forms[0].obs9.value.length > 500 )  {
          alert("La longitud de la observacion del remitente no debe ser mayor a 500");
          return false;
        }  */
        document.forms[0].action = "nuevo.htm";
    	document.forms[0].submit();
	}
	
	function cancelar(){
	    document.forms[0].action = "lista.htm";
	    document.forms[0].submit();
	}
	
	function implicados(){
	    document.forms[0].action = "preimplicados.htm";
	    document.forms[0].submit();
	}
</script>
            <div id="contenedor">
                <!--Capa que contiene toda la plantilla-->
                <jsp:include page="../includes/cabecera.jsp" flush="true"/>
                 
                <div id="cuerpo" align="center">
                    <table class="anchoTotal" align="center" width="90%" border="1">
                        <tr>
                            <td id="anchoMenu" >
                                <jsp:include page="../includes/menu2.jsp" flush="true"/>
                            </td>
                            <td id="anchoCuerpo">
                                                                 
                                <div id="contenido">
                                    <!--Capa que contiene el cuerpo de la plantilla-->                                     
                                    <h2>REGISTRO DE OFICIOS</h2> 
                           
                                   	<div align="center" style="color: red"> <c:out value="${msgError}"/> </div>
									<div align="center" style="color: blue"> <c:out value="${mensaje}"/> </div>
                                           
                                  <!--  <h2>Datos de Alerta</h2> -->
                                   <h3> <span>Datos de Oficio</span> </h3>
                                   
                                   <form:form name="frm2" action="nuevo.htm" method="post" modelAttribute="documento">
                                    
                                    <input type="hidden" name="tipoTram1.idTipotram" value="1"/>
                                    <input type="hidden" name="tipoTram2.idTipotram" value="9"/>
                                    
                                    <form:hidden path="idDocumento"  />
                                    <input type="hidden" name="docEstado" value="1"/>
                                    
                                   <table class="bloqueTablaLineal" cellspacing="6">
                                        <tr>
                                            <th>Fecha de Ingreso:</th>
                                            <td>
                                            	<fmt:formatDate value="${documento.fecRegistro}" pattern="dd/MM/yyyy" var="f_fecRegistro"/>
                                            	<input type="text" name="fecRegistro" id="fecRegistro" size="20" value="${f_fecRegistro}"/>
			                             		<img src="${pageContext.request.contextPath}/images/cal.gif" alt="D&iacute;a/Mes/A&ntilde;o" width="16" height="16" border="0" id="triggerCal" />
												<script type="text/javascript">
												//	var fechita = new Date();
												//	fechota =  fechita.getDate()  + "/" + (fechita.getMonth()+1) + "/" +  fechita.getFullYear();
												//	document.forms[0].fecRegistro.value = fechota;
														Calendar.setup({
															inputField     :    "fecRegistro",  // id del campo de texto
															ifFormat       :    "%d/%m/%Y",  // Formato de la Fecha
															showsTime      :    false,       // Flag para mostrar la Fecha
															button         :    "triggerCal",// ID del elemento que llamara al calendario
															singleClick    :    true         // Flag Modo doble-click 
														});
												</script>
											</td>
                                        </tr>
                                         <tr>
                                            <th>Entidad:</th>
                                            <td>
                                            	<form:select path="entidad.idEntidad" cssStyle="height: 20px; width: 180px; font-family: Arial; font-size: 9pt">
	                                            		<form:options items="${lentidad}" itemLabel="nomEntidad" itemValue="idEntidad"/>
                                            	</form:select>
                                            </td>
                                        </tr>
                                         <tr>
                                            <th>Asunto:</th>
                                            <td><form:input path="docAsunto" size="50"/></td>
                                        </tr>
                                         <tr>
                                            <th>Detalle:</th>
                                            <td><form:textarea path="docContenido" cols="40" rows="5" /></td>
                                        </tr>
                                         <tr>
                                            <th>Documento de respuesta:</th>
                                            <td><form:input path="docRespuesta" size="50"/></td>
                                        </tr>
                                         <tr>
                                            <th>Fecha respuesta:</th>
                                            <td>
                                            	<fmt:formatDate value="${documento.fecDocrespuesta}" pattern="dd/MM/yyyy" var="f_fecDocrespuesta"/>
                                            	<input type="text" name="fecDocrespuesta" id="fecDocrespuesta" size="20" value="${f_fecDocrespuesta}"/>
                                          		<img src="${pageContext.request.contextPath}/images/cal.gif" alt="D&iacute;a/Mes/A&ntilde;o" width="16" height="16" border="0" id="triggerCalr" />
												<script type="text/javascript">
													//var fechita = new Date();
													//fechota =  fechita.getDate()  + "/" + (fechita.getMonth()+1) + "/" +  fechita.getFullYear();
												//	document.forms[0].fecDocrespuesta.value = fechota;
														Calendar.setup({
															inputField     :    "fecDocrespuesta",  // id del campo de texto
															ifFormat       :    "%d/%m/%Y",  // Formato de la Fecha
															showsTime      :    false,       // Flag para mostrar la Fecha
															button         :    "triggerCalr",// ID del elemento que llamara al calendario
															singleClick    :    true         // Flag Modo doble-click 
														});
												</script>
											</td>
                                        </tr>
                                    </table>
                                     
                                    <center>
                                        <table summary="Contenedor Botones"
                                               class="tablaAnchoAjustable">
                                            <tr>
                                                <td>
                                                    <ul class="enlacesCentroAjustables">
                                                        <li>
                                                       		<input type="submit" class="boton" value="Aceptar">
                                                        	<input type="button" onclick="javascript:cancelar();" class="boton" value="Cancelar">
                                                            <c:if test="${ documento.idDocumento != 0}">
                                                            	<input type="button" onclick="javascript:implicados();" class="boton" value="Agregar Personas">
                                                            </c:if>
                                                        </li>
                                                    </ul>
                                                    <ul class="enlacesCentroAjustables">
                                                        <li> &nbsp; </li>
                                                    </ul>
                                                </td>
                                            </tr>
                                        </table>
                                    </center>
                                    </form:form>
                                    
                                     <c:if test="${ documento.idDocumento != 0}">
                                    
                                     <c:if test="${ empty documento.siArchivos }">
                                     
                                    <h3><span>Cargar Archivo</span> </h3>
									<form name="frmFile" action="#" method="post" enctype="multipart/form-data">
										<input type="hidden" name="idDocumento" value="${documento.idDocumento}"/>
		                                 
										<table class="bloqueTablaLineal" cellspacing="6">
											<tr>
	                                            <th>Seleccionar Archivo:</th>
	                                            <td><input type="file" name="txtfile"></td>
	                                        </tr>
	                                   </table>
	                                    <center>
	                                        <table summary="Contenedor Botones" class="tablaAnchoAjustable">
	                                            <tr>
	                                                <td>
	                                                    <ul class="enlacesCentroAjustables">
	                                                        <li><input type="button" onclick="javascript:cargar();" class="boton" value="Cargar"></li>
	                                                    </ul>
	                                                </td>
	                                            </tr>
	                                        </table>
	                                    </center>
                                    </form>
                                   </c:if>
                                    
                                     <c:if test="${ not empty documento.siArchivos }">
		                                    <table class="bloqueTablaLineal" cellspacing="6">
													<c:forEach items="${documento.siArchivos}" var="doc">
													<tr>
			                                            <th>Descargar Archivo:</th>
			                                            <td>
			                                            <a href="descargar.htm?id=${doc.idArchivo}">${doc.nombre}</a>&nbsp;&nbsp;&nbsp;&nbsp;			                                          
			                                            <a href="javascript:eliminar('${doc.idArchivo}','${documento.idDocumento}');" class="btnEnlaceCentro"> 
			                                           		<img title="Eliminar archivo" src="${pageContext.request.contextPath}/images/error.png" width="18" height="18" border="0">
			                                           	</a>
			                                            </td>
			                                        </tr>
			                                        </c:forEach>
			                                   </table>
	                                    </c:if>
                              </c:if>
                               
                                </div>
                               
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <jsp:include page="../includes/pie.jsp" flush="true"/>